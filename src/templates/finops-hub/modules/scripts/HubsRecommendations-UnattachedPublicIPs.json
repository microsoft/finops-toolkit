{
    "inputDataset": "resourceGraph",
    "outputDataset": "Recommendations",
    "provider": "Microsoft",
    "query": "resources | where type =~ 'Microsoft.Network/publicIPAddresses' and isempty(properties.ipConfiguration) and isempty(properties.natGateway) and properties.publicIPAllocationMethod =~ 'Static' | extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, Location=location | project PublicIpId, IPName, SKUName, resourceGroup, Location, AllocationMethod, subscriptionId, type, name | union ( resources | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and isnotempty(properties.ipConfigurations) | extend IPconfig = properties.ipConfigurations | mv-expand IPconfig | extend PublicIpId= tostring(IPconfig.properties.publicIPAddress.id) | project PublicIpId, name | join ( resources | where type =~ 'Microsoft.Network/publicIPAddresses'| extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, resourceGroup, Location=location, name, id ) on PublicIpId | extend PublicIpId,IPName, SKUName, resourceGroup, Location, AllocationMethod,name, subscriptionId )| project     x_RecommendationId=strcat(tolower(PublicIpId),'-idle'),     x_ResourceGroupName=tolower(resourceGroup),     SubAccountId=subscriptionId,     x_RecommendationCategory='Cost',     x_RecommendationImpact='Low',     x_RecommendationTypeId='3ecbf770-9404-4504-a450-cc198e8b2a7d',     x_RecommendationControl='UsageOptimization/OrphanedResources',     x_RecommendationMaturityLevel='Preview',     x_RecommendationDescription='Unattached (orphaned) public IP is incurring in networking costs',     x_RecommendationSolution='Review and remove this resource if not needed',     ResourceId = tolower(PublicIpId),     x_ResourceType=type,     ResourceName=tolower(name),     x_RecommendationDetails= strcat('{\\\"SKUName\\\": ', SKUName, ',\\\"AllocationMethod\\\": \\\"', AllocationMethod,',\\\"Location\\\": \\\"', Location, '\\\" }'),     x_RecommendationDate = now() | join kind=leftouter ( resourcecontainers | where type == 'microsoft.resources/subscriptions' | project SubAccountName=name, SubAccountId=subscriptionId ) on SubAccountId | project-away SubAccountId1",
    "schemaFile": "recommendations_1.0.json",
    "scope": "azurerbac",
    "source": "Azure Resource Graph",
    "type": "HubsRecommendations-UnattachedPublicIPs",
    "version": "1.0"
}