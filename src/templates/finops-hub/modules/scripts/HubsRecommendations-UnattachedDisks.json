{
    "inputDataset": "resourceGraph",
    "outputDataset": "Recommendations",
    "provider": "Microsoft",
    "query": "resources | where type =~ 'microsoft.compute/disks' and isempty(managedBy) | extend diskState = tostring(properties.diskState) | where diskState != 'ActiveSAS' and tags !contains 'ASR-ReplicaDisk' and tags !contains 'asrseeddisk' | extend DiskId=id, DiskIDfull=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB), Location=location, TimeCreated=tostring(properties.timeCreated), SubId=subscriptionId | order by DiskId asc | project DiskId, DiskIDfull, DiskName, DiskSizeGB, SKUName, SKUTier, resourceGroup, Location, TimeCreated, subscriptionId, type| project     x_RecommendationId=strcat(tolower(DiskId),'-unattached'),     x_ResourceGroupName=tolower(resourceGroup),     SubAccountId=subscriptionId,     x_RecommendationCategory='Cost',     x_RecommendationImpact='High',     x_RecommendationTypeId='e0c02939-ce02-4f9d-881f-8067ae7ec90f',     x_RecommendationControl='UsageOptimization/OrphanedResources',     x_RecommendationMaturityLevel='Preview',     x_RecommendationDescription='Unattached (orphaned) disk is incurring in storage costs',     x_RecommendationSolution='Remove or downgrade the unattached disk',     ResourceId = tolower(DiskId),     x_ResourceType=type,     ResourceName=tolower(DiskName),     x_RecommendationDetails= strcat('{\\\"DiskSizeGB\\\": ', DiskSizeGB, ', \\\"SKUName\\\": \\\"', SKUName, '\\\", \\\"SKUTier\\\": \\\"', SKUTier, '\\\", \\\"Location\\\": \\\"', Location, '\\\", \\\"TimeCreated\\\": \\\"', TimeCreated, '\\\" }'),     x_RecommendationDate = now() | join kind=leftouter ( resourcecontainers | where type == 'microsoft.resources/subscriptions' | project SubAccountName=name, SubAccountId=subscriptionId ) on SubAccountId | project-away SubAccountId1",
    "schemaFile": "recommendations_1.0.json",
    "scope": "azurerbac",
    "source": "ResourceGraph",
    "type": "HubsRecommendations-UnattachedDisks",
    "version": "1.0"
}