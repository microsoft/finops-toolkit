{
    "dataset": "Recommendations",
    "provider": "Microsoft",
    "query": "resources | where type =~ 'Microsoft.Network/applicationGateways' | extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools,resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)| project id, name, SKUName, SKUTier, SKUCapacity,resourceGroup,subscriptionId, AppGWName=name, type, Location=location| join (    resources    | where type =~ 'Microsoft.Network/applicationGateways'    | mvexpand backendPools = properties.backendAddressPools    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)    | extend backendPoolName  = backendPools.properties.backendAddressPools.name    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by id) on id| project-away id1| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))| project     x_RecommendationId=strcat(tolower(id),'-idle'),     x_ResourceGroupName=tolower(resourceGroup),     SubAccountId=subscriptionId,     x_RecommendationCategory='Cost',     x_RecommendationDescription='Application Gateway without any backend pool',     ResourceId = tolower(id),     ResourceName=tolower(AppGWName),     x_RecommendationDetails= strcat('{\"backendIPCount\": ', backendIPCount, ', \"Location\": \"', Location, '\", \"x_RecommendationProvider\": \"Azure Resource Graph\", \"x_RecommendationSolution\": \"Review and remove this resource if not needed\", \"x_RecommendationTypeId\": \"4f69df93-5972-44e0-97cf-4343c2bcf4b8\", \"x_ResourceType\": \"', type, '\", \"x_RecommendationMaturityLevel\": \"Preview\"}'),     x_RecommendationDate = now() | join kind=leftouter ( resourcecontainers | where type == 'microsoft.resources/subscriptions' | project SubAccountName=name, SubAccountId=subscriptionId ) on SubAccountId | project-away SubAccountId1",
    "queryEngine": "resourceGraph",
    "scope": "tenant",
    "source": "Azure Resource Graph",
    "type": "HubsRecommendations-BackendlessAppGateways",
    "version": "1.0"
}
