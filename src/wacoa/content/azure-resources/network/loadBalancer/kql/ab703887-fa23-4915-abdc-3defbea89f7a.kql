//ARG
//CHeck for idle LB
resources
| extend SKUName=tostring(sku.name) 
| extend SKUTier=tostring(sku.tier), Location=location 
| extend backendAddressPools = properties.backendAddressPools
| where type =~ 'microsoft.network/loadbalancers' and array_length(backendAddressPools) == 0 and sku.name!='Basic' 
| extend id,name, SKUName,SKUTier,backendAddressPools, location,resourceGroup, subscriptionId, type
| project 
    x_RecommendationId=strcat(tolower(id),'-idle'), 
    x_ResourceGroupName=tolower(resourceGroup), 
    SubAccountId=subscriptionId, 
    x_RecommendationCategory='Cost', 
    x_RecommendationProvider='Microsoft.FinOpsToolkit', 
    x_RecommendationImpact='High', 
    x_RecommendationTypeId='ab703887-fa23-4915-abdc-3defbea89f7a', 
    x_RecommendationControl='UsageOptimization/OrphanedResources', 
    x_RecommendationMaturityLevel='Preview', 
    x_RecommendationDescription='Load balancer without a backend pool', 
    x_RecommendationSolution='Review and remove this resource if not needed', 
    ResourceId = tolower(id), 
    x_ResourceType=type, 
    ResourceName=tolower(name), 
    x_RecommendationDetails= strcat('\"SKUName\": ', SKUName, ',\"SKUTier\": \"', SKUTier, ',\"Location\": \"', Location), 
    x_RecommendationDate = now() 
| join kind=leftouter ( resourcecontainers | where type == 'microsoft.resources/subscriptions' | project SubAccountName=name, SubAccountId=subscriptionId ) on SubAccountId 
| project-away SubAccountId1