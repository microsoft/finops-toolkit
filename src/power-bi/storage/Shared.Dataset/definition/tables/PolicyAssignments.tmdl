table PolicyAssignments
	lineageTag: fc42feb2-59a9-44bf-8459-e2c1592a05dd

	column id
		dataType: string
		lineageTag: 1d348226-a506-40a1-8192-5ec485e0af9e
		summarizeBy: none
		sourceColumn: id

		annotation SummarizationSetBy = Automatic

	column name
		dataType: string
		lineageTag: ff261d9a-3eef-498a-8636-ff52bf63770c
		summarizeBy: none
		sourceColumn: name

		annotation SummarizationSetBy = Automatic

	column 'properties.policyDefinitionId'
		dataType: string
		lineageTag: 36991dc9-f91b-42b4-9748-be127108cfde
		summarizeBy: none
		sourceColumn: properties.policyDefinitionId

		annotation SummarizationSetBy = Automatic

	column 'properties.effectiveDefinitionVersion'
		dataType: string
		lineageTag: 16da8ecd-c393-4286-a7cd-1040228789be
		summarizeBy: none
		sourceColumn: properties.effectiveDefinitionVersion

		annotation SummarizationSetBy = Automatic

	column 'properties.latestDefinitionVersion'
		dataType: string
		lineageTag: 3bca024d-238d-4d9b-bbb0-d684521dd31d
		summarizeBy: none
		sourceColumn: properties.latestDefinitionVersion

		annotation SummarizationSetBy = Automatic

	column 'properties.nonComplianceMessages'
		dataType: string
		lineageTag: 57b279a8-b3c2-4044-9e04-de1cc0c6164a
		summarizeBy: none
		sourceColumn: properties.nonComplianceMessages

		annotation SummarizationSetBy = Automatic

	column 'properties.definitionVersion'
		dataType: string
		lineageTag: 9aebe9eb-2371-4b13-9c76-36b3c5c823d6
		summarizeBy: none
		sourceColumn: properties.definitionVersion

		annotation SummarizationSetBy = Automatic

	column 'properties.resourceSelectors'
		dataType: string
		lineageTag: 11813bfd-1f37-488d-9285-1e772849b256
		summarizeBy: none
		sourceColumn: properties.resourceSelectors

		annotation SummarizationSetBy = Automatic

	column 'properties.enforcementMode'
		dataType: string
		lineageTag: d4584d1e-b6da-4040-b6a4-7134c0672510
		summarizeBy: none
		sourceColumn: properties.enforcementMode

		annotation SummarizationSetBy = Automatic

	column 'properties.assignmentType'
		dataType: string
		lineageTag: 6819787b-73a8-4e0e-8070-023568c7b976
		summarizeBy: none
		sourceColumn: properties.assignmentType

		annotation SummarizationSetBy = Automatic

	column 'properties.description'
		dataType: string
		lineageTag: d3ea744d-704e-48ee-9c5a-d8a17344916d
		summarizeBy: none
		sourceColumn: properties.description

		annotation SummarizationSetBy = Automatic

	column 'properties.displayName'
		dataType: string
		lineageTag: 5c957d8e-fd18-4850-960e-be9a8af7bccd
		summarizeBy: none
		sourceColumn: properties.displayName

		annotation SummarizationSetBy = Automatic

	column 'properties.parameters'
		dataType: string
		lineageTag: 1b67137d-df28-4b74-8513-486851b8628f
		summarizeBy: none
		sourceColumn: properties.parameters

		annotation SummarizationSetBy = Automatic

	column 'properties.notScopes'
		dataType: string
		lineageTag: e804ae45-625e-44c0-b9b7-faab55df20fc
		summarizeBy: none
		sourceColumn: properties.notScopes

		annotation SummarizationSetBy = Automatic

	column 'properties.overrides'
		dataType: string
		lineageTag: 1d20ddb9-f2f3-41d2-9449-dfea4797fb7f
		summarizeBy: none
		sourceColumn: properties.overrides

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.createdOn'
		dataType: string
		lineageTag: c2e66679-d4aa-440f-b152-d5d57460bea8
		summarizeBy: none
		sourceColumn: properties.metadata.createdOn

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.createdBy'
		dataType: string
		lineageTag: 9b40d28e-65b2-4ae1-92b1-7f60becaf430
		summarizeBy: none
		sourceColumn: properties.metadata.createdBy

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.assignedBy'
		dataType: string
		lineageTag: 5f9f32b3-e881-4748-814c-30eec5c31a6d
		summarizeBy: none
		sourceColumn: properties.metadata.assignedBy

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.parameterScopes'
		dataType: string
		lineageTag: cd98c09d-2563-4c18-b3ab-8843c0ec89fa
		summarizeBy: none
		sourceColumn: properties.metadata.parameterScopes

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.updatedOn'
		dataType: string
		lineageTag: 2a9a3ec7-6033-442b-95dd-ca16a8aa1a58
		summarizeBy: none
		sourceColumn: properties.metadata.updatedOn

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.updatedBy'
		dataType: string
		lineageTag: eff9fd70-f125-4e24-af7f-00c272ad7bd4
		summarizeBy: none
		sourceColumn: properties.metadata.updatedBy

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.category'
		dataType: string
		lineageTag: 359d4829-4b57-4c18-867f-175a3b77dfc9
		summarizeBy: none
		sourceColumn: properties.metadata.category

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.managedByResourceId'
		dataType: string
		lineageTag: c1974d8c-1e1f-429c-802c-ef88431e904a
		summarizeBy: none
		sourceColumn: properties.metadata.managedByResourceId

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.securityCenter'
		dataType: string
		lineageTag: 314cbab7-3be5-4e85-9d9f-9fe808ccc0be
		summarizeBy: none
		sourceColumn: properties.metadata.securityCenter

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata.excludedOutOfTheBoxStandards'
		dataType: string
		lineageTag: 01fd1c38-2a24-4858-9335-8bd5cfdab130
		summarizeBy: none
		sourceColumn: properties.metadata.excludedOutOfTheBoxStandards

		annotation SummarizationSetBy = Automatic

	column 'properties.scope'
		dataType: string
		lineageTag: 445e8666-eaf2-4846-8f0f-439c5f6bf9da
		summarizeBy: none
		sourceColumn: properties.scope

		annotation SummarizationSetBy = Automatic

	column 'identity.userAssignedIdentities'
		dataType: string
		lineageTag: 8586946a-0e29-4772-b707-275f248a986b
		summarizeBy: none
		sourceColumn: identity.userAssignedIdentities

		annotation SummarizationSetBy = Automatic

	column 'identity.principalId'
		dataType: string
		lineageTag: c41ce4d0-bbea-4b58-b2d9-31d310c82775
		summarizeBy: none
		sourceColumn: identity.principalId

		annotation SummarizationSetBy = Automatic

	column 'identity.tenantId'
		dataType: string
		lineageTag: 3c44bc44-86b1-4fc9-af7b-0d1c0c80a39f
		summarizeBy: none
		sourceColumn: identity.tenantId

		annotation SummarizationSetBy = Automatic

	column 'identity.type'
		dataType: string
		lineageTag: ab440e5d-da40-4376-8be6-ddae6a99cb27
		summarizeBy: none
		sourceColumn: identity.type

		annotation SummarizationSetBy = Automatic

	column 'properties.metadata'
		dataType: string
		lineageTag: a94cc1c6-bf08-40f6-91b4-5ce811d3b876
		summarizeBy: none
		sourceColumn: properties.metadata

		annotation SummarizationSetBy = Automatic

	partition PolicyAssignments = m
		mode: import
		queryGroup: 'Resource Graph'
		source =
				let
				  query = "
				    policyResources
				    | where type =~'Microsoft.Authorization/PolicyAssignments'
				    | extend
				      ['properties.policyDefinitionId'] = properties.policyDefinitionId,
				      ['properties.effectiveDefinitionVersion'] = properties.effectiveDefinitionVersion,
				      ['properties.latestDefinitionVersion'] = properties.latestDefinitionVersion,
				      ['properties.nonComplianceMessages'] = properties.nonComplianceMessages,
				      ['properties.definitionVersion'] = properties.definitionVersion,
				      ['properties.resourceSelectors'] = properties.resourceSelectors,
				      ['properties.enforcementMode'] = properties.enforcementMode,
				      ['properties.assignmentType'] = properties.assignmentType,
				      ['properties.description'] = properties.description,
				      ['properties.displayName'] = properties.displayName,
				      ['properties.parameters'] = properties.parameters,
				      ['properties.notScopes'] = properties.notScopes,
				      ['properties.overrides'] = properties.overrides,
				      ['properties.metadata'] = properties.metadata,
				      ['properties.scope'] = properties.scope,
				      ['properties.metadata.createdOn'] = properties.metadata.createdOn,
				      ['properties.metadata.createdBy'] = properties.metadata.createdBy,
				      ['properties.metadata.assignedBy'] = properties.metadata.assignedBy,
				      ['properties.metadata.parameterScopes'] = properties.metadata.parameterScopes,
				      ['properties.metadata.updatedOn'] = properties.metadata.updatedOn,
				      ['properties.metadata.updatedBy'] = properties.metadata.updatedBy,
				      ['properties.metadata.category'] = properties.metadata.category,
				      ['properties.metadata.managedByResourceId'] = properties.metadata.managedByResourceId,
				      ['properties.metadata.securityCenter'] = properties.metadata.securityCenter,
				      ['properties.metadata.excludedOutOfTheBoxStandards'] = properties.metadata.excludedOutOfTheBoxStandards,
				      ['identity.userAssignedIdentities'] = identity.userAssignedIdentities,
				      ['identity.principalId'] = identity.principalId,
				      ['identity.tenantId'] = identity.tenantId,
				      ['identity.type'] = identity.type
				    | mv-expand ['properties.notScopes']
				  " & ftk_DemoFilter(),
				  Source = AzureResourceGraph.Query(query, "Tenant", null, null, [resultTruncated = false]),
				  NullHandling =
				    if Table.HasColumns(Source, "Results") and Table.RowCount(Source) = 1 then
							#table(
								{ "id", "name", "properties.policyDefinitionId", "properties.effectiveDefinitionVersion", "properties.latestDefinitionVersion", "properties.nonComplianceMessages", "properties.definitionVersion", "properties.resourceSelectors", "properties.enforcementMode", "properties.assignmentType", "properties.description", "properties.displayName", "properties.parameters", "properties.notScopes", "properties.overrides", "properties.metadata", "properties.scope", "properties.metadata.createdOn", "properties.metadata.createdBy", "properties.metadata.assignedBy", "properties.metadata.parameterScopes", "properties.metadata.updatedOn", "properties.metadata.updatedBy", "properties.metadata.category", "properties.metadata.managedByResourceId", "properties.metadata.securityCenter", "properties.metadata.excludedOutOfTheBoxStandards", "identity.userAssignedIdentities", "identity.principalId", "identity.tenantId", "identity.type" },
								{}
							)
				    else Source
				in
				  NullHandling

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

