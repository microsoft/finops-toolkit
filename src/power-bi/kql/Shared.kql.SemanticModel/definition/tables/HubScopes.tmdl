table HubScopes
	lineageTag: 666d6d87-203b-4ee4-a058-e1fd88cd07bd

	column Scope
		dataType: string
		lineageTag: 3c532ad3-35d4-4346-a811-e762662ba1f9
		summarizeBy: none
		sourceColumn: Scope

		annotation SummarizationSetBy = Automatic

	partition HubScopes = m
		mode: import
		queryGroup: Storage
		source =
				let
					ADLS = if #"Storage URL" = "" or #"Storage URL" = null then null else AzureStorage.DataLake(#"Storage URL" & "/../config"),
				
					Settings = if ADLS = null then null else Json.Document(ADLS{[Name="settings.json"]}[Content], 1252),
					Scopes = if ADLS = null then null else Settings[scopes],
					ToTable = if ADLS = null then null else try Table.FromList(Scopes, Splitter.SplitByNothing(), {"Scope"}, null, ExtraValues.Ignore) otherwise #table({"Scope"}, {}),
					AppendQueries = if ADLS = null then null else Table.Combine({ToTable, StorageData}),
					RemoveTestData = if ADLS = null then null else Table.SelectRows(AppendQueries, each [Scope] <> null and [Scope] <> "" and [Scope] <> "/foo"),
					Scope = if ADLS = null then null else Table.SelectColumns(RemoveTestData, {"Scope"}),
					Lowercase = if ADLS = null then null else Table.TransformColumns(Scope,{{"Scope", Text.Lower, type text}}),
					Distinct = if ADLS = null then null else Table.Distinct(Lowercase)
				in
					Distinct

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

